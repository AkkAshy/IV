{% extends 'custom_admin/base.html' %}
{% block title %}
    {% if form.instance.pk %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç{% else %}–î–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç{% endif %}
{% endblock %}
{% block content %}
<h1>
    {% if form.instance.pk %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç{% else %}–î–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç{% endif %}
</h1>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {% if form.non_field_errors %}
        <div class="alert alert-danger">
            {{ form.non_field_errors }}
        </div>
    {% endif %}
    <div class="row">
        <div class="col-md-6">

            <!-- üß± –ë–ª–æ–∫: –í—ã–±–æ—Ä –∑–¥–∞–Ω–∏—è -->
            <h5>1. –í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ</h5>
            {% if buildings %}
                <div class="mb-3">
                    <label for="{{ form.building.id_for_label }}" class="form-label">{{ form.building.label }}</label>
                    {{ form.building }}
                    {% if form.building.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.building.errors }}
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <div class="alert alert-warning">
                    <strong>–ù–µ—Ç –∑–¥–∞–Ω–∏–π.</strong> –î–æ–±–∞–≤—å—Ç–µ –∑–¥–∞–Ω–∏–µ –Ω–∏–∂–µ.
                </div>
            {% endif %}

            <!-- üÜï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–¥–∞–Ω–∏—è -->
            <h6 class="mt-3">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ</h6>
            <div class="input-group mb-4">
                <input type="text" name="new_building_name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–¥–∞–Ω–∏—è">
                <button type="submit" name="create_building" class="btn btn-outline-secondary">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <!-- ü™ú –ë–ª–æ–∫: –í—ã–±–æ—Ä —ç—Ç–∞–∂–∞ -->
            <h5>2. –í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–∂</h5>
            <div class="mb-3">
                <label for="{{ form.floor.id_for_label }}" class="form-label">{{ form.floor.label }}</label>
                {{ form.floor }}
                {% if form.floor.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.floor.errors }}
                    </div>
                {% endif %}
            </div>

            <!-- üÜï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç—Ç–∞–∂–∞ -->
            <h6 class="mt-3">–î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–∂ –∫ –∑–¥–∞–Ω–∏—é</h6>
            <div class="input-group mb-4">
                <select name="building_for_floor" class="form-control">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ</option>
                    {% for building in buildings %}
                        <option value="{{ building.id }}">{{ building.name }}</option>
                    {% endfor %}
                </select>
                <input type="number" name="new_floor_number" class="form-control" placeholder="–ù–æ–º–µ—Ä —ç—Ç–∞–∂–∞">
                <button type="submit" name="create_floor" class="btn btn-outline-secondary">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <!-- üè∑ –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è -->
            <div class="mb-3">
                <label for="{{ form.number.id_for_label }}" class="form-label">{{ form.number.label }}</label>
                {{ form.number }}
                {% if form.number.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.number.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
                {{ form.name }}
                {% if form.name.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.name.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="mb-3 form-check">
                {{ form.is_special }}
                <label for="{{ form.is_special.id_for_label }}" class="form-check-label">{{ form.is_special.label }}</label>
                {% if form.is_special.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.is_special.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.photo.id_for_label }}" class="form-label">{{ form.photo.label }}</label>
                {{ form.photo }}
                {% if form.instance.photo %}
                    <p class="mt-2">
                        <img src="{{ form.instance.photo.url }}" alt="–§–æ—Ç–æ –∫–∞–±–∏–Ω–µ—Ç–∞" style="max-width: 100px;">
                    </p>
                {% endif %}
                {% if form.photo.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.photo.errors }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- üß≠ –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="mt-3">
        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <a href="{% url 'custom_admin:room_list' %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
</form>

<!-- üîÅ JS: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞ —ç—Ç–∞–∂–µ–π -->
<script>
document.getElementById('{{ form.building.id_for_label }}').addEventListener('change', function() {
    const buildingId = this.value;
    const floorSelect = document.getElementById('{{ form.floor.id_for_label }}');
    const floors = {{ floors|safe }};

    floorSelect.innerHTML = '<option value="">---------</option>';

    floors.forEach(floor => {
        if (floor.building == buildingId) {
            const option = document.createElement('option');
            option.value = floor.id;
            option.text = `–≠—Ç–∞–∂ ${floor.number}`;
            floorSelect.appendChild(option);
        }
    });
});
</script>
{% endblock %}
